<html dir="rtl" lang="fa-IR">
{%  load static %}
{% load custom_filters %}
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="/static/ConfigurationChangeRequest/css/bootstrap.min.css" >
    <link rel="stylesheet" type="text/css" href="/static/ConfigurationChangeRequest/css/jquery-confirm.min.css" >
    <link rel="stylesheet" type="text/css" href="/static/ConfigurationChangeRequest/css/all.min.css" >
    <link rel="stylesheet" type="text/css" href="/static/ConfigurationChangeRequest/scss/select2.scss">
    <link rel="stylesheet" type="text/css" href="/static/ConfigurationChangeRequest/scss/fontawesome.scss">
    <link rel="stylesheet" type="text/css" href="/static/ConfigurationChangeRequest/css/request.css">
    <!-- Extra CSS -->
    {% block extra_css %}{% endblock %}

    <title>درخواست تغییرات</title>
    <subtitle>{{ page_title }}</subtitle>

<!-- Meta tags برای انتقال پیام‌های context به JavaScript -->
{% if message %}
    <meta name="context-message" content="{{ message }}">
    {% if success == False %}
        <meta name="context-success" content="false">
    {% else %}
        <meta name="context-success" content="true">
    {% endif %}
{% endif %}

{% if success_message %}
    <meta name="context-success-message" content="{{ success_message }}">
{% endif %}

{% if warning_message %}
    <meta name="context-warning-message" content="{{ warning_message }}">
{% endif %}    
</head>

<body>
    <form id="requestForm" method="POST" action="">
    <div class="header">

            {% csrf_token %}
            <input type="hidden" name="request_id" id="request_id" value="{{request.id}}"/>

            <div class="col-2">
                <img src="{% static 'ConfigurationChangeRequest/images/EIT.png' %}" alt="فناوران اطلاعات خبره" title="فناوران اطلاعات خبره" class="logo">
            </div>
            <div class='button-container right col-2'>
                {% if status == 'INSERT' %}
                <button type="submit" class="btn btn-primary" id="save">شروع فرآیند</button>
                {% elif status == 'UPDATE' %}
                <button type="submit" class="btn btn-primary confirm" data-status="{{ request.status_code }}">تایید</button>
                {% endif %}
            </div>
            <div class="title col-4">
                {% if page_title %}{{ page_title }}{% else %}درخواست تغییرات{% endif %}
                <div class="step-button">
                    <span class="step">{{bc}}</span>
                </div> 
            </div>
            <div class='button-container left col-2'>
                {% if status == 'INSERT' %}
                <button type="reset" class="btn btn-warning">لغو</button>
                {% elif status == 'UPDATE' %}
                <button type="button" class="btn btn-danger" id="reject">رد مدرک</button>
                {% endif %}
            </div>
            <div class='info col-2'>
                <p><b>شماره درخواست: </b>
                    <span>
                        {% if request_number and request_number|to_int > 1 %}
                            {{ request_number }}
                        {% else %}
                            -
                        {% endif %}
                    </span>
                </p>
                <p><b>تاریخ ثبت درخواست: </b>
                    <span>
                        {% if request.create_date %}
                            {{ request.create_date|to_jalali:"%Y/%m/%d" }}
                        {% else %}
                            {% now "Y-m-d" as today_gregorian %}
                            {{ today_gregorian|to_jalali:"%Y/%m/%d" }}
                        {% endif %}
                    </span>
                </p>
            </div>

    </div>

    {% block main_content%}
    {% endblock %}
    
    <!--form buttons -->
    <div class="row mt-4">
        <div class="col-12">
            {% if mode == 'UPDATE' %}
                <button type="submit" name="action" value="approve" class="btn btn-success" onclick="handleFormSubmit(event, 'approve')">تایید</button>
                <button type="submit" name="action" value="reject" class="btn btn-danger ms-2" onclick="handleFormSubmit(event, 'reject')">رد</button>
                <button type="button" class="btn btn-secondary ms-2" onclick="handleFormSubmit(event, 'back')">بازگشت</button>
            {% elif mode != 'READONLY' %}
                <button type="submit" class="btn btn-primary" onclick="handleFormSubmit(event, 'start')">شروع فرآیند</button>
                <button type="button" class="btn btn-secondary ms-2" onclick="handleFormSubmit(event, 'back')">بازگشت</button>
            {% else %}
                <button type="button" class="btn btn-secondary" onclick="window.close()">بستن پنجره</button>
            {% endif %}
        </div>
    </div>


    <!-- Footer -->
    <footer class="bg-light text-center text-muted py-3 mt-5">
        <div class="container">
            <p>&copy; 2024 سیستم مدیریت درخواست تغییرات. تمامی حقوق محفوظ است.</p>
        </div>
    </footer>

</form>
</body>
<script src="/static/ConfigurationChangeRequest/js/jquery-3.6.0.min.js"></script>
<script src="/static/ConfigurationChangeRequest/js/jquery-confirm.min.js"></script>
<script src="/static/ConfigurationChangeRequest/js/select2.min.js"></script>
<script src="/static/ConfigurationChangeRequest/js/message-handler.js"></script>
<script src="/static/ConfigurationChangeRequest/js/bootstrap.bundle.min.js"></script>
<script src="/static/ConfigurationChangeRequest/js/request.js"></script>

    
    <!-- Custom JavaScript -->
    {% block extra_js %}{% endblock %}

</html>