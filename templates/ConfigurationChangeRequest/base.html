<html dir="rtl" lang="fa-IR">
{%  load static %}
{% load custom_filters %}
<head>
    <meta charset="utf-8">
    <link rel="icon" href="static/ConfigurationChangeRequest/favicon.ico">
    <link rel="stylesheet" type="text/css" href="/static/ConfigurationChangeRequest/css/bootstrap.min.css" >
    <link rel="stylesheet" type="text/css" href="/static/ConfigurationChangeRequest/css/jquery-confirm.min.css" >
    <link rel="stylesheet" type="text/css" href="/static/ConfigurationChangeRequest/css/all.min.css" >
    <link rel="stylesheet" type="text/css" href="/static/ConfigurationChangeRequest/css/select2.min.css">
    <link rel="stylesheet" type="text/css" href="/static/ConfigurationChangeRequest/scss/fontawesome.scss">
    <link rel="stylesheet" type="text/css" href="/static/ConfigurationChangeRequest/css/request.css">
    <!-- Extra CSS -->
    {% block extra_css %}{% endblock %}

    <title>
        درخواست تغییرات
        {% if mode != 'READONLY' %}
            - {% if status_title %}{{ status_title }}{% else %}ثبت درخواست{% endif %}
        {% else %}
            (فقط خواندنی)
        {% endif %}
    </title>
<!-- Meta tags برای انتقال پیام‌های context به JavaScript -->
{% if message %}
    <meta name="context-message" content="{{ message }}">
    {% if success == False %}
        <meta name="context-success" content="false">
    {% else %}
        <meta name="context-success" content="true">
    {% endif %}
{% endif %}

{% if success_message %}
    <meta name="context-success-message" content="{{ success_message }}">
{% endif %}

{% if warning_message %}
    <meta name="context-warning-message" content="{{ warning_message }}">
{% endif %}    
</head>

<body>
    <form id="requestForm" method="POST" action="">
    <div class="header">

            {% csrf_token %}
            <input type="hidden" name="request_id" id="request_id" value="{{request.id}}"/>

            <div class="col-2">
                <img src="{% static 'ConfigurationChangeRequest/images/EIT.png' %}" alt="فناوران اطلاعات خبره" title="فناوران اطلاعات خبره" class="logo">
            </div>
            <div class="title-text col-4">
                <div class="title">درخواست تغییرات</div>
                <div class="subtitle">
                    {% if mode != 'READONLY' %}
                    {% if status_title %}{{ status_title }}{% else %}ثبت درخواست{% endif %}
                    {% else %}
                        (فقط خواندنی)
                    {% endif %}
                </div>
            </div>
            <div class='info col-2'>
                <p><b>شماره درخواست: </b>
                    <span>
                        {% if request.id and request.id|to_int > 1 %}
                            {{ request.id }}
                        {% else %}
                            -
                        {% endif %}
                    </span>
                </p>
                <p><b>تاریخ ثبت درخواست: </b>
                    <span>
                        {% if request.create_date %}
                            {{ request.create_date|to_jalali:"%Y/%m/%d" }}
                        {% else %}
                            {% now "Y-m-d" as today_gregorian %}
                            {{ today_gregorian|to_jalali:"%Y/%m/%d" }}
                        {% endif %}
                    </span>
                </p>
            </div>

    </div>
    
    <div class="container mt-4">
        {% block main_content%}
        {% endblock %}

        <!--form buttons -->
        <div class="row mt-4 form-button">
            <div class="col-12">
                {% if mode == 'UPDATE' %}
                    <button type="button" name="action" value="approve" class="btn btn-success" onclick="handleFormSubmit(event, 'CON')" data-orginal-text="تایید">تایید</button>
                    <button type="button" name="action" value="reject" class="btn btn-danger ms-2" onclick="handleFormSubmit(event, 'REJ')" data-orginal-text="رد">رد</button>
                    <button type="button" name="action" value="return" class="btn btn-secondary ms-2" onclick="handleFormSubmit(event, 'RET')" data-orginal-text="بازگشت">بازگشت</button>
                {% elif mode != 'READONLY' %}
                    <button type="button" name="action" value="start" class="btn btn-primary" onclick="handleFormSubmit(event, 'start')" data-orginal-text="شروع فرآیند">شروع فرآیند</button>
                    <button type="button" name="action" value="close" class="btn btn-secondary ms-2" onclick="window.close()" data-orginal-text="بازگشت">بازگشت</button>
                {% else %}
                    <button type="button" class="btn btn-secondary" onclick="window.close()">بستن پنجره</button>
                {% endif %}
            </div>
        </div>
    </div>


    <!-- Footer -->
    <footer class="bg-light text-center text-muted py-3 mt-5">
        <div class="container">
            <p>&copy; 2024 سیستم مدیریت درخواست تغییرات. تمامی حقوق محفوظ است.</p>
        </div>
    </footer>

</form>
</body>
<script src="/static/ConfigurationChangeRequest/js/jquery-3.6.0.min.js"></script>
<script src="/static/ConfigurationChangeRequest/js/jquery-confirm.min.js"></script>
<script src="/static/ConfigurationChangeRequest/js/select2.min.js"></script>
<script src="/static/ConfigurationChangeRequest/js/message-handler.js"></script>
<script src="/static/ConfigurationChangeRequest/js/bootstrap.bundle.min.js"></script>
<script src="/static/ConfigurationChangeRequest/js/request.js"></script>
<!-- Custom JavaScript -->
{% block extra_js %}{% endblock %}

    

</html>